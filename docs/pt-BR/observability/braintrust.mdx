---
title: Braintrust
description: Integra√ß√£o do Braintrust para CrewAI com rastreamento OpenTelemetry e avalia√ß√£o
icon: magnifying-glass-chart
mode: "wide"
---

# Integra√ß√£o Braintrust

Este guia demonstra como integrar o **Braintrust** com **CrewAI** usando OpenTelemetry para rastreamento e avalia√ß√£o abrangentes. Ao final deste guia, voc√™ poder√° rastrear seus agentes CrewAI, monitorar seu desempenho e avaliar suas sa√≠das usando a poderosa plataforma de observabilidade do Braintrust.

> **O que √© Braintrust?** [Braintrust](https://www.braintrust.dev) √© uma plataforma de avalia√ß√£o e observabilidade de IA que fornece rastreamento, avalia√ß√£o e monitoramento abrangentes para aplica√ß√µes de IA com rastreamento de experimentos e an√°lises de desempenho integrados.

## Come√ßar

Vamos percorrer um exemplo simples de uso do CrewAI e integra√ß√£o com Braintrust via OpenTelemetry para observabilidade e avalia√ß√£o abrangentes.

### Passo 1: Instalar Depend√™ncias

```bash
uv add braintrust[otel] crewai crewai-tools opentelemetry-instrumentation-openai opentelemetry-instrumentation-crewai python-dotenv
```

### Passo 2: Configurar Vari√°veis de Ambiente

Configure as chaves de API do Braintrust e configure o OpenTelemetry para enviar rastreamentos para o Braintrust. Voc√™ precisar√° de uma chave de API do Braintrust e sua chave de API do OpenAI.

```python
import os
from getpass import getpass

# Obter suas credenciais do Braintrust
BRAINTRUST_API_KEY = getpass("üîë Digite sua Chave de API do Braintrust: ")

# Obter chaves de API para servi√ßos
OPENAI_API_KEY = getpass("üîë Digite sua chave de API do OpenAI: ")

# Configurar vari√°veis de ambiente
os.environ["BRAINTRUST_API_KEY"] = BRAINTRUST_API_KEY
os.environ["BRAINTRUST_PARENT"] = "project_name:crewai-demo"
os.environ["OPENAI_API_KEY"] = OPENAI_API_KEY
```

### Passo 3: Inicializar OpenTelemetry com Braintrust

Inicialize a instrumenta√ß√£o OpenTelemetry do Braintrust para come√ßar a capturar rastreamentos e envi√°-los para o Braintrust.

```python
import os
from typing import Any, Dict

from braintrust.otel import BraintrustSpanProcessor
from crewai import Agent, Crew, Task
from crewai.llm import LLM
from opentelemetry import trace
from opentelemetry.instrumentation.crewai import CrewAIInstrumentor
from opentelemetry.instrumentation.openai import OpenAIInstrumentor
from opentelemetry.sdk.trace import TracerProvider

def setup_tracing() -> None:
    """Configurar rastreamento OpenTelemetry com Braintrust."""
    current_provider = trace.get_tracer_provider()
    if isinstance(current_provider, TracerProvider):
        provider = current_provider
    else:
        provider = TracerProvider()
        trace.set_tracer_provider(provider)

    provider.add_span_processor(BraintrustSpanProcessor())
    CrewAIInstrumentor().instrument(tracer_provider=provider)
    OpenAIInstrumentor().instrument(tracer_provider=provider)


setup_tracing()
```

### Passo 4: Criar uma Aplica√ß√£o CrewAI

Vamos criar uma aplica√ß√£o CrewAI onde dois agentes colaboram para pesquisar e escrever um post de blog sobre avan√ßos em IA, com rastreamento abrangente habilitado.

```python
from crewai import Agent, Crew, Process, Task
from crewai_tools import SerperDevTool

def create_crew() -> Crew:
    """Criar uma crew com m√∫ltiplos agentes para rastreamento abrangente."""
    llm = LLM(model="gpt-4o-mini")
    search_tool = SerperDevTool()

    # Definir agentes com pap√©is espec√≠ficos
    researcher = Agent(
        role="Analista de Pesquisa S√™nior",
        goal="Descobrir desenvolvimentos de ponta em IA e ci√™ncia de dados",
        backstory="""Voc√™ trabalha em um think tank de tecnologia l√≠der.
        Sua especialidade est√° em identificar tend√™ncias emergentes.
        Voc√™ tem talento para dissecar dados complexos e apresentar insights acion√°veis.""",
        verbose=True,
        allow_delegation=False,
        llm=llm,
        tools=[search_tool],
    )

    writer = Agent(
        role="Estrategista de Conte√∫do Tecnol√≥gico",
        goal="Criar conte√∫do envolvente sobre avan√ßos tecnol√≥gicos",
        backstory="""Voc√™ √© um Estrategista de Conte√∫do renomado, conhecido por seus artigos perspicazes e envolventes.
        Voc√™ transforma conceitos complexos em narrativas convincentes.""",
        verbose=True,
        allow_delegation=True,
        llm=llm,
    )

    # Criar tarefas para seus agentes
    research_task = Task(
        description="""Realize uma an√°lise abrangente dos √∫ltimos avan√ßos em {topic}.
        Identifique tend√™ncias principais, tecnologias revolucion√°rias e impactos potenciais na ind√∫stria.""",
        expected_output="Relat√≥rio de an√°lise completo em pontos de bala",
        agent=researcher,
    )

    writing_task = Task(
        description="""Usando os insights fornecidos, desenvolva um post de blog envolvente
        que destaque os avan√ßos mais significativos em {topic}.
        Seu post deve ser informativo, mas acess√≠vel, atendendo a um p√∫blico conhecedor de tecnologia.
        Fa√ßa soar legal, evite palavras complexas para n√£o soar como IA.""",
        expected_output="Post de blog completo de pelo menos 4 par√°grafos",
        agent=writer,
        context=[research_task],
    )

    # Instanciar sua crew com um processo sequencial
    crew = Crew(
        agents=[researcher, writer], 
        tasks=[research_task, writing_task], 
        verbose=True, 
        process=Process.sequential
    )

    return crew

def run_crew():
    """Executar a crew e retornar resultados."""
    crew = create_crew()
    result = crew.kickoff(inputs={"topic": "desenvolvimentos em IA"})
    return result

# Executar sua crew
if __name__ == "__main__":
    # A instrumenta√ß√£o j√° foi inicializada acima neste m√≥dulo
    result = run_crew()
    print(result)
```

### Passo 5: Visualizar Rastreamentos no Braintrust

Ap√≥s executar sua crew, voc√™ pode visualizar rastreamentos abrangentes no Braintrust atrav√©s de diferentes perspectivas:

<Tabs>
  <Tab title="Rastreamento(Trace)">
    <Frame>
      <img src="/images/braintrust-trace-view.png" alt="Visualiza√ß√£o de Rastreamento Braintrust"/>
    </Frame>
  </Tab>
  
  <Tab title="Linha do Tempo(Timeline)">
    <Frame>
      <img src="/images/braintrust-timeline-view.png" alt="Visualiza√ß√£o de Linha do Tempo Braintrust"/>
    </Frame>
  </Tab>
  
  <Tab title="Thread">
    <Frame>
      <img src="/images/braintrust-thread-view.png" alt="Visualiza√ß√£o de Thread Braintrust"/>
    </Frame>
  </Tab>
</Tabs>

### Passo 6: Avaliar via SDK (Experimentos)

Voc√™ tamb√©m pode executar avalia√ß√µes usando o Eval SDK do Braintrust. Isso √© √∫til para comparar vers√µes ou pontuar sa√≠das offline. Abaixo est√° um exemplo em Python usando a classe `Eval` com a crew que criamos acima:

```python
# eval_crew.py
from braintrust import Eval
from autoevals import Levenshtein

def evaluate_crew_task(input_data):
    """Fun√ß√£o de tarefa que envolve nossa crew para avalia√ß√£o."""
    crew = create_crew()
    result = crew.kickoff(inputs={"topic": input_data["topic"]})
    return str(result)

Eval(
    "Crew de Pesquisa em IA",  # Nome do projeto
    {
        "data": lambda: [
            {"topic": "tend√™ncias de intelig√™ncia artificial 2024"},
            {"topic": "avan√ßos em aprendizado de m√°quina"},
            {"topic": "√©tica e governan√ßa de IA"},
        ],
        "task": evaluate_crew_task,
        "scores": [Levenshtein],
    },
)
```

Configure sua chave de API e execute:

```bash
export BRAINTRUST_API_KEY="YOUR_API_KEY"
braintrust eval eval_crew.py
```

Veja o [guia do Eval SDK do Braintrust](https://www.braintrust.dev/docs/start/eval-sdk) para mais detalhes.

### Principais Recursos da Integra√ß√£o Braintrust

- **Rastreamento Abrangente**: Rastreie todas as intera√ß√µes de agentes, uso de ferramentas e chamadas LLM
- **Monitoramento de Desempenho**: Monitore tempos de execu√ß√£o, uso de tokens e taxas de sucesso
- **Rastreamento de Experimentos**: Compare diferentes configura√ß√µes de crew e modelos
- **Avalia√ß√£o Automatizada**: Configure m√©tricas de avalia√ß√£o personalizadas para sa√≠das de crew
- **Rastreamento de Erros**: Monitore e depure falhas em suas execu√ß√µes de crew
- **An√°lise de Custos**: Rastreie uso de tokens e custos associados

### Informa√ß√µes de Compatibilidade de Vers√£o
- Python 3.8+
- CrewAI >= 0.86.0
- Braintrust >= 0.1.0
- OpenTelemetry SDK >= 1.31.0

### Refer√™ncias
- [Documenta√ß√£o Braintrust](https://www.braintrust.dev/docs) - Vis√£o geral da plataforma Braintrust
- [Integra√ß√£o CrewAI Braintrust](https://www.braintrust.dev/docs/integrations/crew-ai) - Guia oficial de integra√ß√£o CrewAI
- [Eval SDK Braintrust](https://www.braintrust.dev/docs/start/eval-sdk) - Execute experimentos via SDK
- [Documenta√ß√£o CrewAI](https://docs.crewai.com/) - Vis√£o geral do framework CrewAI
- [Documenta√ß√£o OpenTelemetry](https://opentelemetry.io/docs/) - Guia OpenTelemetry
- [GitHub Braintrust](https://github.com/braintrustdata/braintrust) - C√≥digo fonte do SDK Braintrust
