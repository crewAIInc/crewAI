---
title: Integra√ß√£o DSL MCP
description: Aprenda a usar a sintaxe DSL simples do CrewAI para integrar servidores MCP diretamente com seus agentes usando o campo mcps.
icon: code
mode: "wide"
---

## Vis√£o Geral

A integra√ß√£o DSL (Domain Specific Language) MCP do CrewAI oferece a **forma mais simples** de conectar seus agentes aos servidores MCP (Model Context Protocol). Basta adicionar um campo `mcps` ao seu agente e o CrewAI cuida de toda a complexidade automaticamente.

<Info>
Esta √© a **abordagem recomendada** para a maioria dos casos de uso de MCP. Para cen√°rios avan√ßados que requerem gerenciamento manual de conex√£o, veja [MCPServerAdapter](/pt-BR/mcp/overview#advanced-mcpserveradapter).
</Info>

## Uso B√°sico

Adicione servidores MCP ao seu agente usando o campo `mcps`:

```python
from crewai import Agent

agent = Agent(
    role="Assistente de Pesquisa",
    goal="Ajudar com tarefas de pesquisa e an√°lise",
    backstory="Assistente especialista com acesso a ferramentas avan√ßadas de pesquisa",
    mcps=[
        "https://mcp.exa.ai/mcp?api_key=sua_chave&profile=pesquisa"
    ]
)

# As ferramentas MCP agora est√£o automaticamente dispon√≠veis!
# N√£o √© necess√°rio gerenciamento manual de conex√£o ou configura√ß√£o de ferramentas
```

## Formatos de Refer√™ncia Suportados

### Servidores MCP Remotos Externos

```python
# Servidor HTTPS b√°sico
"https://api.example.com/mcp"

# Servidor com autentica√ß√£o
"https://mcp.exa.ai/mcp?api_key=sua_chave&profile=seu_perfil"

# Servidor com caminho personalizado
"https://services.company.com/api/v1/mcp"
```

### Sele√ß√£o de Ferramentas Espec√≠ficas

Use a sintaxe `#` para selecionar ferramentas espec√≠ficas de um servidor:

```python
# Obter apenas a ferramenta de previs√£o do servidor meteorol√≥gico
"https://weather.api.com/mcp#get_forecast"

# Obter apenas a ferramenta de busca do Exa
"https://mcp.exa.ai/mcp?api_key=sua_chave#web_search_exa"
```

### Marketplace CrewAI AMP

Acesse ferramentas do marketplace CrewAI AMP:

```python
# Servi√ßo completo com todas as ferramentas
"crewai-amp:financial-data"

# Ferramenta espec√≠fica do servi√ßo AMP
"crewai-amp:research-tools#pubmed_search"

# M√∫ltiplos servi√ßos AMP
mcps=[
    "crewai-amp:weather-insights",
    "crewai-amp:market-analysis",
    "crewai-amp:social-media-monitoring"
]
```

## Exemplo Completo

Aqui est√° um exemplo completo usando m√∫ltiplos servidores MCP:

```python
from crewai import Agent, Task, Crew, Process

# Criar agente com m√∫ltiplas fontes MCP
agente_multi_fonte = Agent(
    role="Analista de Pesquisa Multi-Fonte",
    goal="Conduzir pesquisa abrangente usando m√∫ltiplas fontes de dados",
    backstory="""Pesquisador especialista com acesso a busca web, dados meteorol√≥gicos,
    informa√ß√µes financeiras e ferramentas de pesquisa acad√™mica""",
    mcps=[
        # Servidores MCP externos
        "https://mcp.exa.ai/mcp?api_key=sua_chave_exa&profile=pesquisa",
        "https://weather.api.com/mcp#get_current_conditions",

        # Marketplace CrewAI AMP
        "crewai-amp:financial-insights",
        "crewai-amp:academic-research#pubmed_search",
        "crewai-amp:market-intelligence#competitor_analysis"
    ]
)

# Criar tarefa de pesquisa abrangente
tarefa_pesquisa = Task(
    description="""Pesquisar o impacto dos agentes de IA na produtividade empresarial.
    Incluir impactos clim√°ticos atuais no trabalho remoto, tend√™ncias do mercado financeiro,
    e publica√ß√µes acad√™micas recentes sobre frameworks de agentes de IA.""",
    expected_output="""Relat√≥rio abrangente cobrindo:
    1. An√°lise do impacto dos agentes de IA nos neg√≥cios
    2. Considera√ß√µes clim√°ticas para trabalho remoto
    3. Tend√™ncias do mercado financeiro relacionadas √† IA
    4. Cita√ß√µes e insights de pesquisa acad√™mica
    5. An√°lise do cen√°rio competitivo""",
    agent=agente_multi_fonte
)

# Criar e executar crew
crew_pesquisa = Crew(
    agents=[agente_multi_fonte],
    tasks=[tarefa_pesquisa],
    process=Process.sequential,
    verbose=True
)

resultado = crew_pesquisa.kickoff()
print(f"Pesquisa conclu√≠da com {len(agente_multi_fonte.mcps)} fontes de dados MCP")
```

## Recursos Principais

- üîÑ **Descoberta Autom√°tica de Ferramentas**: Ferramentas s√£o descobertas e integradas automaticamente
- üè∑Ô∏è **Preven√ß√£o de Colis√£o de Nomes**: Nomes de servidor s√£o prefixados aos nomes das ferramentas
- ‚ö° **Otimizado para Performance**: Conex√µes sob demanda com cache de esquemas
- üõ°Ô∏è **Resili√™ncia a Erros**: Tratamento gracioso de servidores indispon√≠veis
- ‚è±Ô∏è **Prote√ß√£o por Timeout**: Timeouts integrados previnem conex√µes travadas
- üìä **Integra√ß√£o Transparente**: Funciona perfeitamente com recursos existentes do CrewAI

## Tratamento de Erros

A integra√ß√£o DSL MCP √© projetada para ser resiliente:

```python
agente = Agent(
    role="Agente Resiliente",
    goal="Continuar trabalhando apesar de problemas no servidor",
    backstory="Agente que lida graciosamente com falhas",
    mcps=[
        "https://servidor-confiavel.com/mcp",        # Vai funcionar
        "https://servidor-inalcancavel.com/mcp",     # Ser√° ignorado graciosamente
        "https://servidor-lento.com/mcp",            # Timeout gracioso
        "crewai-amp:servico-funcionando"             # Vai funcionar
    ]
)
# O agente usar√° ferramentas de servidores funcionais e registrar√° avisos para os que falharem
```

## Recursos de Performance

### Cache Autom√°tico

Esquemas de ferramentas s√£o cacheados por 5 minutos para melhorar a performance:

```python
# Primeira cria√ß√£o de agente - descobre ferramentas do servidor
agente1 = Agent(role="Primeiro", goal="Teste", backstory="Teste",
               mcps=["https://api.example.com/mcp"])

# Segunda cria√ß√£o de agente (dentro de 5 minutos) - usa esquemas cacheados
agente2 = Agent(role="Segundo", goal="Teste", backstory="Teste",
               mcps=["https://api.example.com/mcp"])  # Muito mais r√°pido!
```

### Conex√µes Sob Demanda

Conex√µes de ferramentas s√£o estabelecidas apenas quando as ferramentas s√£o realmente usadas:

```python
# Cria√ß√£o do agente √© r√°pida - nenhuma conex√£o MCP feita ainda
agente = Agent(
    role="Agente Sob Demanda",
    goal="Usar ferramentas eficientemente",
    backstory="Agente eficiente que conecta apenas quando necess√°rio",
    mcps=["https://api.example.com/mcp"]
)

# Conex√£o MCP √© feita apenas quando uma ferramenta √© realmente executada
# Isso minimiza o overhead de conex√£o e melhora a performance de inicializa√ß√£o
```

## Melhores Pr√°ticas

### 1. Use Ferramentas Espec√≠ficas Quando Poss√≠vel

```python
# Bom - obter apenas as ferramentas necess√°rias
mcps=["https://weather.api.com/mcp#get_forecast"]

# Menos eficiente - obter todas as ferramentas do servidor
mcps=["https://weather.api.com/mcp"]
```

### 2. Lidar com Autentica√ß√£o de Forma Segura

```python
import os

# Armazenar chaves API em vari√°veis de ambiente
exa_key = os.getenv("EXA_API_KEY")
exa_profile = os.getenv("EXA_PROFILE")

agente = Agent(
    role="Agente Seguro",
    goal="Usar ferramentas MCP com seguran√ßa",
    backstory="Agente consciente da seguran√ßa",
    mcps=[f"https://mcp.exa.ai/mcp?api_key={exa_key}&profile={exa_profile}"]
)
```

### 3. Planejar para Falhas de Servidor

```python
# Sempre incluir op√ß√µes de backup
mcps=[
    "https://api-principal.com/mcp",       # Escolha principal
    "https://api-backup.com/mcp",          # Op√ß√£o de backup
    "crewai-amp:servico-confiavel"         # Fallback AMP
]
```
