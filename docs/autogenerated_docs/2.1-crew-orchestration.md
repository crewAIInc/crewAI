# Crew Orchestration

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [src/crewai/agent.py](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/agent.py)
- [src/crewai/agents/agent_builder/base_agent.py](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/agents/agent_builder/base_agent.py)
- [src/crewai/crew.py](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py)
- [src/crewai/task.py](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/task.py)
- [src/crewai/tools/tool_usage.py](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/tools/tool_usage.py)
- [src/crewai/translations/en.json](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/translations/en.json)

</details>



This document covers the core orchestration system that coordinates agents and tasks within CrewAI. Crew orchestration manages the execution flow, agent assignment, task dependencies, and process coordination. For information about individual agent behavior and execution patterns, see [Agent Execution](#2.2). For task-specific management and output handling, see [Task Management](#2.3). For process-specific coordination patterns, see [Process Types](#2.4).

## Overview and Architecture

The `Crew` class serves as the central orchestrator that manages collections of agents and tasks, coordinating their execution through defined processes. The orchestration system handles agent-task assignment, execution flow control, context passing between tasks, and integration with memory and knowledge systems.

```mermaid
graph TD
    subgraph "Crew Orchestration Core"
        Crew["Crew<br/>(crew.py)"]
        Process["Process<br/>(sequential/hierarchical)"]
        Execution["_execute_tasks()"]
    end
    
    subgraph "Agent Management"
        AgentList["agents: List[BaseAgent]"]
        ManagerAgent["manager_agent<br/>(hierarchical only)"]
        Delegation["Agent Delegation<br/>Tools"]
    end
    
    subgraph "Task Management" 
        TaskList["tasks: List[Task]"]
        TaskAssignment["_get_agent_to_use()"]
        Context["_get_context()"]
        AsyncTasks["Async Task<br/>Execution"]
    end
    
    subgraph "Memory Integration"
        STM["Short Term<br/>Memory"]
        LTM["Long Term<br/>Memory"] 
        EM["Entity<br/>Memory"]
        ExtMem["External<br/>Memory"]
    end
    
    Crew --> Process
    Crew --> AgentList
    Crew --> TaskList
    Process --> Execution
    Execution --> TaskAssignment
    Execution --> Context
    Execution --> AsyncTasks
    AgentList --> ManagerAgent
    AgentList --> Delegation
    Crew --> STM
    Crew --> LTM
    Crew --> EM
    Crew --> ExtMem
```

Sources: [src/crewai/crew.py:95-257](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L95-L257), [src/crewai/crew.py:774-892](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L774-L892)

## Crew Initialization and Configuration

The `Crew` class initializes with agents, tasks, and configuration parameters that define how orchestration will proceed. Key initialization components include process type selection, memory system setup, and agent-task validation.

| Configuration | Type | Description |
|---------------|------|-------------|
| `agents` | `List[BaseAgent]` | List of agents available for task execution |
| `tasks` | `List[Task]` | Ordered list of tasks to be executed |
| `process` | `Process` | Execution process (sequential or hierarchical) |
| `memory` | `bool` | Enable memory systems for context retention |
| `manager_llm` | `BaseLLM` | Language model for manager agent in hierarchical process |
| `manager_agent` | `BaseAgent` | Custom manager agent for hierarchical coordination |

```mermaid
sequenceDiagram
    participant User
    participant Crew
    participant Validators
    participant Memory
    participant Agents
    
    User->>Crew: "__init__(agents, tasks, process)"
    Crew->>Validators: "check_manager_llm()"
    Crew->>Validators: "validate_tasks()" 
    Crew->>Validators: "check_config()"
    Crew->>Memory: "create_crew_memory()"
    Memory-->>Crew: "Initialize memory systems"
    Crew->>Agents: "set agent configuration"
    Agents-->>Crew: "agents configured"
    Crew-->>User: "Crew instance ready"
```

Sources: [src/crewai/crew.py:283-301](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L283-L301), [src/crewai/crew.py:313-349](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L313-L349), [src/crewai/crew.py:352-392](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L352-L392)

## Process Execution Flow

The orchestration system supports two main execution processes: sequential and hierarchical. The `kickoff()` method serves as the entry point for crew execution, coordinating the chosen process type.

### Sequential Process Flow

In sequential process, tasks execute in order with each task's output serving as context for subsequent tasks.

```mermaid
graph LR
    subgraph "Sequential Execution"
        kickoff["kickoff()"]
        interpolate["_interpolate_inputs()"]
        sequential["_run_sequential_process()"]
        execute["_execute_tasks()"]
        
        subgraph "Task Loop"
            task1["Task 1<br/>Agent A"]
            task2["Task 2<br/>Agent B"]  
            task3["Task 3<br/>Agent C"]
            context["Context<br/>Passing"]
        end
        
        output["CrewOutput"]
    end
    
    kickoff --> interpolate
    interpolate --> sequential
    sequential --> execute
    execute --> task1
    task1 --> context
    context --> task2
    task2 --> context
    context --> task3
    task3 --> output
```

Sources: [src/crewai/crew.py:612-683](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L612-L683), [src/crewai/crew.py:774-776](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L774-L776)

### Hierarchical Process Flow

In hierarchical process, a manager agent coordinates task delegation among team members.

```mermaid
graph TD
    subgraph "Hierarchical Execution"
        kickoff["kickoff()"]
        hierarchical["_run_hierarchical_process()"]
        manager_create["_create_manager_agent()"]
        
        subgraph "Manager Coordination"
            manager["Manager Agent"]
            delegate["Delegation Tools"]
            team["Team Agents"]
        end
        
        execute["_execute_tasks()"]
        output["CrewOutput"]
    end
    
    kickoff --> hierarchical
    hierarchical --> manager_create
    manager_create --> manager
    manager --> delegate
    delegate --> team
    team --> execute
    execute --> output
```

Sources: [src/crewai/crew.py:778-806](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L778-L806), [src/crewai/translations/en.json:2-6](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/translations/en.json#L2-L6)

## Task Assignment and Agent Coordination

The orchestration system assigns agents to tasks using `_get_agent_to_use()` method, which handles both direct assignment and manager delegation scenarios.

```mermaid
graph TD
    subgraph "Agent Assignment Logic"
        task_start["Task Execution Start"]
        get_agent["_get_agent_to_use(task)"]
        
        decision{{"Process Type?"}}
        
        subgraph "Sequential Assignment"
            direct["task.agent"]
            validate_direct["Validate Agent"]
        end
        
        subgraph "Hierarchical Assignment" 
            manager_check["manager_agent exists?"]
            use_manager["Use Manager Agent"]
        end
        
        prepare_tools["_prepare_tools()"]
        execute_task["agent.execute_task()"]
    end
    
    task_start --> get_agent
    get_agent --> decision
    decision -->|"Sequential"| direct
    decision -->|"Hierarchical"| manager_check
    direct --> validate_direct
    manager_check --> use_manager
    validate_direct --> prepare_tools
    use_manager --> prepare_tools
    prepare_tools --> execute_task
```

Sources: [src/crewai/crew.py:838-851](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L838-L851), [src/crewai/crew.py:919-943](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L919-L943)

## Context Management and Task Dependencies

The orchestration system manages task context through `_get_context()` method, which aggregates outputs from previous tasks and specific context dependencies.

| Context Type | Source | Usage |
|--------------|--------|-------|
| Sequential Context | Previous task outputs | Automatic context passing |
| Explicit Context | `task.context` list | Specific task dependencies |
| Async Context | Last synchronous output | Context for async tasks |

```mermaid
graph LR
    subgraph "Context Flow Management"
        task["Current Task"]
        get_context["_get_context(task, task_outputs)"]
        
        subgraph "Context Sources"
            prev_outputs["Previous Task<br/>Outputs"]
            explicit_context["task.context<br/>Dependencies"]
            last_sync["Last Sync<br/>Output"]
        end
        
        context_string["Formatted<br/>Context String"]
        agent_exec["Agent Execution<br/>with Context"]
    end
    
    task --> get_context
    prev_outputs --> get_context
    explicit_context --> get_context
    last_sync --> get_context
    get_context --> context_string
    context_string --> agent_exec
```

Sources: [src/crewai/crew.py:951-974](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L951-L974), [src/crewai/crew.py:864-891](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L864-L891)

## Asynchronous Task Execution

The orchestration system supports asynchronous task execution through `Future` objects, managing both async and synchronous task coordination.

```mermaid
sequenceDiagram
    participant Orchestrator as "_execute_tasks()"
    participant AsyncTask as "Async Task"
    participant SyncTask as "Sync Task"
    participant Futures as "futures: List"
    
    Orchestrator->>AsyncTask: "task.execute_async()"
    AsyncTask-->>Futures: "Future[TaskOutput]"
    Note over Futures: "Store future for later processing"
    
    Orchestrator->>SyncTask: "Sync task encountered"
    Orchestrator->>Futures: "_process_async_tasks()"
    Futures-->>Orchestrator: "Completed TaskOutputs"
    
    Orchestrator->>SyncTask: "task.execute_sync()"
    SyncTask-->>Orchestrator: "TaskOutput"
```

Sources: [src/crewai/crew.py:863-889](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L863-L889), [src/crewai/crew.py:976-988](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L976-L988)

## Memory Integration in Orchestration  

The crew orchestration integrates with multiple memory systems to maintain context across task executions and crew runs.

```mermaid
graph TD
    subgraph "Memory Integration"
        crew["Crew Orchestration"]
        memory_init["_initialize_default_memories()"]
        
        subgraph "Memory Systems"
            stm["ShortTermMemory<br/>_short_term_memory"]
            ltm["LongTermMemory<br/>_long_term_memory"] 
            em["EntityMemory<br/>_entity_memory"]
            ext["ExternalMemory<br/>_external_memory"]
        end
        
        subgraph "Memory Usage"
            agent_mem["Agent Memory<br/>Access"]
            context_mem["Contextual<br/>Memory"]
            storage["Memory<br/>Storage"]
        end
    end
    
    crew --> memory_init
    memory_init --> stm
    memory_init --> ltm
    memory_init --> em
    crew --> ext
    stm --> agent_mem
    ltm --> context_mem
    em --> storage
    ext --> context_mem
```

Sources: [src/crewai/crew.py:303-328](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L303-L328), [src/crewai/crew.py:147-166](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L147-L166)

## Tool Management and Delegation

The orchestration system manages tool distribution and delegation capabilities across agents, with special handling for hierarchical processes.

```mermaid
graph TD
    subgraph "Tool Management System"
        prepare["_prepare_tools(agent, task, tools)"]
        
        delegation_check{{"Agent allows<br/>delegation?"}}
        process_check{{"Hierarchical<br/>Process?"}}
        
        subgraph "Delegation Tools"
            manager_tools["_update_manager_tools()"]
            agent_tools["_add_delegation_tools()"]
            delegation_tools["AgentTools(agents).tools()"]
        end
        
        subgraph "Code Execution"
            code_check{{"Allow code<br/>execution?"}}
            code_tools["_add_code_execution_tools()"]
        end
        
        final_tools["Final Tool List"]
    end
    
    prepare --> delegation_check
    delegation_check -->|"Yes"| process_check
    process_check -->|"Yes"| manager_tools
    process_check -->|"No"| agent_tools
    manager_tools --> delegation_tools
    agent_tools --> delegation_tools
    delegation_check -->|"No"| code_check
    delegation_tools --> code_check
    code_check -->|"Yes"| code_tools
    code_check -->|"No"| final_tools
    code_tools --> final_tools
```

Sources: [src/crewai/crew.py:919-950](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/crew.py#L919-L950), [src/crewai/translations/en.json:47-48](https://github.com/crewAIInc/crewAI/blob/81bd81e5/src/crewai/translations/en.json#L47-L48)

## Output Aggregation and Callbacks

The orchestration system aggregates task outputs and manages callback execution throughout the crew lifecycle.

```mermaid
sequenceDiagram
    participant Crew
    participant Callbacks as "Callback System"
    participant Tasks as "Task Outputs"
    participant Output as "CrewOutput"
    
    Note over Crew: "Before execution"
    Crew->>Callbacks: "before_kickoff_callbacks"
    Callbacks-->>Crew: "Modified inputs"
    
    Note over Crew: "During execution"  
    Crew->>Tasks: "Execute tasks"
    Tasks-->>Crew: "TaskOutput objects"
    
    Note over Crew: "After execution"
    Crew->>Output: "_create_crew_output()"
    Crew->>Callbacks: "after_kickoff_callbacks"
    Callbacks-->>Crew: "Modified CrewOutput"
    
    Crew->>Crew: "calculate_usage_metrics()"
```