<!DOCTYPE html>
<html lang="EN">
<head>
    <title>CrewAI Flow Visualization</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="'{{ css_path }}'" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="'{{ js_path }}'"></script>
</head>
<body>
    <!-- Drawer overlay -->
    <div id="drawer-overlay"></div>

    <!-- Highlight canvas for active nodes/edges above overlay -->
    <canvas id="highlight-canvas"></canvas>

    <!-- Side drawer -->
    <div id="drawer" style="visibility: hidden;">
        <div class="drawer-header">
            <div class="drawer-title" id="drawer-node-name">Node Details</div>
            <div style="display: flex; align-items: center;">
                <button class="drawer-open-ide" id="drawer-open-ide" style="display: none;">
                    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 2 L12 2 L12 14 L4 14 Z" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6 5 L10 5 M6 8 L10 8 M6 11 L10 11" stroke-linecap="round"/>
                    </svg>
                    Open in IDE
                </button>
                <button class="drawer-close" id="drawer-close">Ã—</button>
            </div>
        </div>
        <div class="drawer-content" id="drawer-content"></div>
    </div>

    <div id="info">
        <div style="text-align: center; margin-bottom: 20px;">
            <img src="https://cdn.prod.website-files.com/68de1ee6d7c127849807d7a6/68de1ee6d7c127849807d7ef_Logo.svg"
                 alt="CrewAI Logo"
                 style="width: 120px; height: auto;">
        </div>
        <h3>Flow Execution</h3>
        <div class="stats">
            <p><strong>Nodes:</strong> '{{ dag_nodes_count }}'</p>
            <p><strong>Edges:</strong> '{{ dag_edges_count }}'</p>
            <p><strong>Topological Paths:</strong> '{{ execution_paths }}'</p>
        </div>
        <div class="legend">
            <div class="legend-title">Node Types</div>
            <div class="legend-item">
                <div class="legend-color" style="background: '{{ CREWAI_ORANGE }}';"></div>
                <span>Start Methods</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: '{{ DARK_GRAY }}'; border: 3px solid '{{ CREWAI_ORANGE }}';"></div>
                <span>Router Methods</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: '{{ DARK_GRAY }}';"></div>
                <span>Listen Methods</span>
            </div>
        </div>
        <div class="legend">
            <div class="legend-title">Edge Types</div>
            <div class="legend-item">
                <svg width="24" height="12" style="margin-right: 12px;">
                    <line x1="0" y1="6" x2="24" y2="6" stroke="'{{ CREWAI_ORANGE }}'" stroke-width="2" stroke-dasharray="5,5"/>
                </svg>
                <span>Router Paths</span>
            </div>
            <div class="legend-item">
                <svg width="24" height="12" style="margin-right: 12px;" class="legend-or-line">
                    <line x1="0" y1="6" x2="24" y2="6" stroke="var(--edge-or-color)" stroke-width="2"/>
                </svg>
                <span>OR Conditions</span>
            </div>
            <div class="legend-item">
                <svg width="24" height="12" style="margin-right: 12px;">
                    <line x1="0" y1="6" x2="24" y2="6" stroke="'{{ CREWAI_ORANGE }}'" stroke-width="2"/>
                </svg>
                <span>AND Conditions</span>
            </div>
        </div>
        <div class="instructions">
            <strong>Interactions:</strong><br>
            â€¢ Drag to pan<br>
            â€¢ Scroll to zoom<br><br>
            <strong>IDE:</strong>
            <select id="ide-selector" style="width: 100%; padding: 4px; margin-top: 4px; border-radius: 3px; border: 1px solid #e0e0e0; background: white; font-size: 12px; cursor: pointer; pointer-events: auto; position: relative; z-index: 10;">
                <option value="auto">Auto-detect</option>
                <option value="pycharm">PyCharm</option>
                <option value="vscode">VS Code</option>
                <option value="jetbrains">JetBrains (Toolbox)</option>
            </select>
        </div>
    </div>

    <!-- Custom navigation controls -->
    <div class="nav-controls">
        <div class="nav-button" id="theme-toggle" title="Toggle Dark Mode">ðŸŒ™</div>
        <div class="nav-button" id="zoom-in" title="Zoom In">+</div>
        <div class="nav-button" id="zoom-out" title="Zoom Out">âˆ’</div>
        <div class="nav-button" id="fit" title="Fit to Screen">âŠ¡</div>
        <div class="nav-button" id="export-png" title="Export to PNG">ðŸ–¼</div>
        <div class="nav-button" id="export-pdf" title="Export to PDF">ðŸ“„</div>
        <div class="nav-button" id="export-json" title="Export to JSON">{}</div>
    </div>

    <div id="network-container">
        <div id="network"></div>
    </div>
</body>
</html>
